package tei;

import java.io.File;
import java.util.ArrayList;
import java.util.List;

import javax.xml.parsers.DocumentBuilder;
import javax.xml.parsers.DocumentBuilderFactory;

import org.w3c.dom.Document;
import org.w3c.dom.Node;
import org.w3c.dom.NodeList;


public class TEIReader {
	
	 
	 
	public static List<Article> parseTEIFile(String filePath){
		List<Article> articles = new ArrayList<Article>();
		try{
			 DocumentBuilderFactory factory = DocumentBuilderFactory.newInstance();
			 DocumentBuilder builder = factory.newDocumentBuilder();
			 Document document = builder.parse(new File(filePath));
			 NodeList nodeList = document.getDocumentElement().getChildNodes();
			 
			 String fileName = filePath;
			 for(int i = 0 ; i< nodeList.getLength();i++){
				 Node element = nodeList.item(i);
				 if(element.getNodeName().equals("text")){
					 NodeList elements = element.getChildNodes();
					 for(int j = 0 ; j < elements.getLength(); j++){
						 Node child = elements.item(j);
						 if(child.getNodeName().equals("body")){
							 
							 NodeList childs = child.getChildNodes();
							 for(int k = 0 ; k < childs.getLength(); k++){
								 Node article = childs.item(k);
								 if(article.getNodeName().equalsIgnoreCase("div")){
									// if(article.getAttributes().getNamedItem("type") !=null 
										//	 && article.getAttributes().getNamedItem("type").getNodeValue().equals("article")){
										 	//System.out.println(article.getTextContent());
										 	String text = article.getTextContent();
										 	String headText = "";
										 	//IR._matchWithOntology(article.getTextContent());
										 	 NodeList heads = article.getChildNodes();
											 for(int l = 0 ; l < heads.getLength(); l++){
												 Node head = heads.item(l);
												 if(head.getNodeName().equals("head")){
													 //System.out.println(head.getTextContent());
													 headText = head.getTextContent();
													 break;
													 
												 }
											 }
										 articles.add(new Article(fileName, headText, text));
									// }
										 		
								 }
							 }
							 
							 break;
							 
						 }
					 }
					 
					 break;
					 
				 }
					 
			 }
			
		}catch(Exception e){
			
		}
		
		return articles;
		
	}
	public static void main(String [] args) throws Exception{
//		List<Article> articles = TEIReader.parseTEIFile("nicole_traite-de-la-comedie_1675.xml");
//		
//		for(Article a : articles){
//			System.out.println(a.getFileName() + " "+a.getHead().replace("\n"," ").trim());
//		}
		
		 DocumentBuilderFactory factory = DocumentBuilderFactory.newInstance();
		 DocumentBuilder builder = factory.newDocumentBuilder();
		 Document document = builder.parse(new File("aubignac_dissertation_1666.xml"));
		 NodeList nodeList = document.getElementsByTagNameNS("text", "div");
		 
		 System.out.println(nodeList.getLength());
		

	}

}
